<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Pokédex</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      text-align: center;
      background: #f2f2f2;
      margin: 0;
      padding: 20px;
    }
    h1 {
      color: #cc0000;
    }
    input, select {
      padding: 10px;
      font-size: 16px;
      border: 1px solid #ccc;
      border-radius: 5px;
      margin: 5px;
    }
    button {
      padding: 10px 15px;
      font-size: 16px;
      background-color: #cc0000;
      color: white;
      border: none;
      border-radius: 5px;
      cursor: pointer;
    }
    button:hover {
      background-color: #a30000;
    }
    #pokemon-container {
      margin-top: 30px;
    }
    .pokemon-card {
      background: white;
      display: inline-block;
      padding: 20px;
      border-radius: 10px;
      box-shadow: 2px 2px 10px rgba(0,0,0,0.2);
      text-align: center;
      max-width: 600px;
    }
    .pokemon-card img {
      width: 150px;
      margin: 5px;
    }
    .evo-img {
      width: 60px;
      margin: 0 5px;
    }
    .info-section {
      text-align: left;
      margin-top: 15px;
    }
    .info-section h3 {
      margin-bottom: 5px;
      color: #cc0000;
    }
    .info-section ul {
      padding-left: 20px;
      margin-top: 0;
    }
    .evolution-chain {
      margin-top: 15px;
      font-weight: bold;
    }
    #all-pokemon-list {
      display: flex;
      flex-wrap: wrap;
      justify-content: center;
      margin-top: 30px;
    }
    .dex-entry {
      border: 1px solid #ccc;
      border-radius: 8px;
      background-color: #fff;
      margin: 5px;
      padding: 10px;
      width: 150px;
      text-align: center;
      cursor: pointer;
      transition: transform 0.2s;
    }
    .dex-entry:hover {
      transform: scale(1.05);
    }
    .dex-entry img {
      width: 50px;
      display: block;
      margin: 5px auto;
    }
  </style>
</head>
<body>
  <h1>Pokédex</h1>

  <input type="text" id="search" placeholder="Enter Pokémon name or ID" />
  <button onclick="loadForms()">Search</button>

  <!-- Generation Filter -->
  <select id="generation-filter" onchange="loadAllPokemon()">
    <option value="1" selected>Gen 1 (Kanto)</option>
    <option value="2">Gen 2 (Johto)</option>
    <option value="3">Gen 3 (Hoenn)</option>
    <option value="4">Gen 4 (Sinnoh)</option>
    <option value="5">Gen 5 (Unova)</option>
    <option value="6">Gen 6 (Kalos)</option>
    <option value="7">Gen 7 (Alola)</option>
    <option value="8">Gen 8 (Galar)</option>
    <option value="9">Gen 9 (Paldea)</option>
    <option value="all">All Generations</option>
  </select>

  <div id="form-selector"></div>
  <div id="pokemon-container"></div>
  <div id="all-pokemon-list"></div>

  <script>
    let formsData = [];
    let currentFormName = '';
    let currentRegion = '';

    const generationRanges = {
      1: [1, 151],      // Kanto
      2: [152, 251],    // Johto
      3: [252, 386],    // Hoenn
      4: [387, 493],    // Sinnoh
      5: [494, 649],    // Unova
      6: [650, 721],    // Kalos
      7: [722, 809],    // Alola
      8: [810, 905],    // Galar
      9: [906, 1025]    // Paldea
    };

    async function loadForms() {
      const nameOrId = document.getElementById('search').value.toLowerCase().trim();
      const formSelector = document.getElementById('form-selector');
      const container = document.getElementById('pokemon-container');
      container.innerHTML = '';
      formSelector.innerHTML = '';

      if (!nameOrId) {
        container.innerHTML = '<p>Please enter a Pokémon name or ID.</p>';
        return;
      }

      try {
        const speciesResponse = await fetch(`https://pokeapi.co/api/v2/pokemon-species/${nameOrId}`);
        if (!speciesResponse.ok) throw new Error('Species not found');
        const speciesData = await speciesResponse.json();

        formsData = speciesData.varieties;

        if (formsData.length > 1) {
          const select = document.createElement('select');
          select.id = 'form-select';
          formsData.forEach(variety => {
            const option = document.createElement('option');
            option.value = variety.pokemon.name;
            option.text = variety.pokemon.name.replace(/-/g, ' ');
            select.appendChild(option);
          });

          const button = document.createElement('button');
          button.textContent = 'Load Form';
          button.onclick = () => getPokemon(select.value);

          formSelector.appendChild(select);
          formSelector.appendChild(button);
        }

        getPokemon(formsData[0].pokemon.name);

      } catch (error) {
        container.innerHTML = `<p>${error.message}</p>`;
      }
    }

    async function getPokemon(pokemonName) {
      const container = document.getElementById('pokemon-container');
      container.innerHTML = '<p>Loading...</p>';
      currentFormName = pokemonName;

      try {
        const response = await fetch(`https://pokeapi.co/api/v2/pokemon/${pokemonName}`);
        if (!response.ok) throw new Error('Pokémon form not found');
        const data = await response.json();

        const speciesResponse = await fetch(data.species.url);
        const speciesData = await speciesResponse.json();
        const evolutionResponse = await fetch(speciesData.evolution_chain.url);
        const evolutionData = await evolutionResponse.json();

        const abilities = data.abilities.map(a => a.ability.name).join(', ');
        const stats = data.stats.map(s => `${s.stat.name}: ${s.base_stat}`).join('<br>');
        const totalStats = data.stats.reduce((sum, stat) => sum + stat.base_stat, 0);
        const moves = data.moves.slice(0, 5).map(m => m.move.name).join(', ');

        const evolutionHTML = await getMatchingEvolutionChain(data.name, evolutionData.chain);

        const genderDifferences = data.sprites.front_female ? `<img src="${data.sprites.front_female}" alt="Female ${data.name}" />` : '';

        container.innerHTML = `
          <div class="pokemon-card">
            <h2>${data.name.toUpperCase().replace(/-/g, ' ')}</h2>
            <img src="${data.sprites.front_default}" alt="${data.name}" />
            <img src="${data.sprites.front_shiny}" alt="Shiny ${data.name}" />
            ${genderDifferences}
            <p><strong>Type:</strong> ${data.types.map(t => t.type.name).join(', ')}</p>
            <p><strong>Height:</strong> ${data.height}</p>
            <p><strong>Weight:</strong> ${data.weight}</p>
            <div class="info-section">
              <h3>Abilities</h3>
              <p>${abilities}</p>
              <h3>Stats</h3>
              <p>${stats}</p>
              <p><strong>Total:</strong> ${totalStats}</p>
              <h3>Moves (First 5)</h3>
              <p>${moves}</p>
              <div class="evolution-chain">
                <h3>Evolution Chain</h3>
                <div>${evolutionHTML}</div>
              </div>
            </div>
          </div>
        `;
      } catch (error) {
        container.innerHTML = `<p>${error.message}</p>`;
      }
    }

    async function getMatchingEvolutionChain(currentName, chain) {
      const segments = [];

      async function findMatchingForm(name) {
        const speciesResponse = await fetch(`https://pokeapi.co/api/v2/pokemon-species/${name}`);
        const speciesData = await speciesResponse.json();
        return speciesData.varieties.find(v => v.pokemon.name === currentFormName) || speciesData.varieties[0];
      }

      async function buildChainLink(link) {
        const form = await findMatchingForm(link.species.name);
        const pokemonResponse = await fetch(form.pokemon.url);
        const pokemonData = await pokemonResponse.json();
        return `<div style="display:inline-block;text-align:center;cursor:pointer;" onclick="getPokemon('${form.pokemon.name}')">
                  <img class="evo-img" src="${pokemonData.sprites.front_default}" alt="${form.pokemon.name}" />
                  <br>${form.pokemon.name.toUpperCase().replace(/-/g, ' ')}
                </div>`;
      }

      let current = chain;
      while (current) {
        segments.push(await buildChainLink(current));
        if (current.evolves_to.length > 0) {
          current = current.evolves_to[0];
        } else {
          break;
        }
      }

      return segments.join(' → ');
    }

    async function loadAllPokemon() {
      const container = document.getElementById('all-pokemon-list');
      container.innerHTML = "<p>Loading Pokémon...</p>";

      const response = await fetch('https://pokeapi.co/api/v2/pokemon?limit=1025');
      const data = await response.json();
      const entries = data.results;

      // Use selected generation
      const genSelect = document.getElementById("generation-filter").value;
      let min = 1, max = 1025;
      if (genSelect !== "all") {
        [min, max] = generationRanges[genSelect];
      }

      container.innerHTML = "";

      for (let i = min - 1; i < max; i++) {
        const res = await fetch(entries[i].url);
        const pokeData = await res.json();
        const entryDiv = document.createElement('div');
        entryDiv.className = 'dex-entry';
        entryDiv.innerHTML = `
          <strong>#${pokeData.id} ${pokeData.name.toUpperCase()}</strong>
          <img src="${pokeData.sprites.front_default}" alt="${pokeData.name}" />
          <img src="${pokeData.sprites.front_shiny}" alt="Shiny ${pokeData.name}" />
        `;

        entryDiv.onclick = () => {
          document.getElementById("search").value = pokeData.name;
          getPokemon(pokeData.name);
          window.scrollTo({ top: 0, behavior: "smooth" });
        };

        container.appendChild(entryDiv);
      }
    }

    // Auto-load Gen 1 on page start
    window.onload = () => {
      document.getElementById("generation-filter").value = "1";
      loadAllPokemon();
    };
  </script>
</body>
</html>
